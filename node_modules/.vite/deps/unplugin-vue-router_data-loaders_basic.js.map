{
  "version": 3,
  "sources": ["../../unplugin-vue-router/dist/data-loaders/basic.js"],
  "sourcesContent": ["// src/data-loaders/defineLoader.ts\nimport {\n  useRoute,\n  useRouter\n} from \"vue-router\";\nimport {\n  ABORT_CONTROLLER_KEY,\n  APP_KEY,\n  IS_USE_DATA_LOADER_KEY,\n  LOADER_ENTRIES_KEY,\n  NAVIGATION_RESULTS_KEY,\n  PENDING_LOCATION_KEY,\n  STAGED_NO_VALUE,\n  NavigationResult,\n  getCurrentContext,\n  setCurrentContext,\n  IS_SSR_KEY\n} from \"unplugin-vue-router/runtime\";\nimport { shallowRef } from \"vue\";\nfunction defineBasicLoader(nameOrLoader, _loaderOrOptions, opts) {\n  const loader = typeof nameOrLoader === \"function\" ? nameOrLoader : _loaderOrOptions;\n  opts = typeof _loaderOrOptions === \"object\" ? _loaderOrOptions : opts;\n  const options = {\n    ...DEFAULT_DEFINE_LOADER_OPTIONS,\n    ...opts,\n    // avoid opts overriding with `undefined`\n    commit: opts?.commit || DEFAULT_DEFINE_LOADER_OPTIONS.commit\n  };\n  function load(to, router, parent) {\n    const entries = router[LOADER_ENTRIES_KEY];\n    const isSSR = router[IS_SSR_KEY];\n    if (!entries.has(loader)) {\n      entries.set(loader, {\n        // force the type to match\n        data: shallowRef(),\n        isLoading: shallowRef(false),\n        error: shallowRef(),\n        options,\n        children: /* @__PURE__ */ new Set(),\n        resetPending() {\n          this.pendingLoad = null;\n          this.pendingTo = null;\n        },\n        pendingLoad: null,\n        pendingTo: null,\n        staged: STAGED_NO_VALUE,\n        stagedError: null,\n        commit\n      });\n    }\n    const entry = entries.get(loader);\n    if (entry.pendingTo === to && entry.pendingLoad) {\n      return entry.pendingLoad;\n    }\n    const { error, isLoading, data } = entry;\n    const initialRootData = router[INITIAL_DATA_KEY];\n    const key = options.key || \"\";\n    let initialData = STAGED_NO_VALUE;\n    if (initialRootData && key in initialRootData) {\n      initialData = initialRootData[key];\n      delete initialRootData[key];\n    }\n    if (initialData !== STAGED_NO_VALUE) {\n      data.value = initialData;\n      return entry.pendingLoad = Promise.resolve();\n    }\n    entry.pendingTo = to;\n    isLoading.value = true;\n    const currentContext = getCurrentContext();\n    if (process.env.NODE_ENV === \"development\") {\n      if (parent !== currentContext[0]) {\n        console.warn(\n          `\\u274C\\u{1F476} \"${options.key}\" has a different parent than the current context. This shouldn't be happening. Please report a bug with a reproduction to https://github.com/posva/unplugin-vue-router/`\n        );\n      }\n    }\n    setCurrentContext([entry, router, to]);\n    entry.staged = STAGED_NO_VALUE;\n    entry.stagedError = error.value;\n    const currentLoad = Promise.resolve(\n      loader(to, { signal: to.meta[ABORT_CONTROLLER_KEY].signal })\n    ).then((d) => {\n      if (entry.pendingLoad === currentLoad) {\n        if (d instanceof NavigationResult) {\n          to.meta[NAVIGATION_RESULTS_KEY].push(d);\n        } else {\n          entry.staged = d;\n          entry.stagedError = null;\n        }\n      }\n    }).catch((e) => {\n      if (entry.pendingLoad === currentLoad) {\n        entry.stagedError = e;\n        if (!options.lazy || isSSR) {\n          throw e;\n        }\n      }\n    }).finally(() => {\n      setCurrentContext(currentContext);\n      if (entry.pendingLoad === currentLoad) {\n        isLoading.value = false;\n        if (options.commit === \"immediate\" || // outside of navigation\n        !router[PENDING_LOCATION_KEY]) {\n          entry.commit(to);\n        }\n      } else {\n      }\n    });\n    setCurrentContext(currentContext);\n    entry.pendingLoad = currentLoad;\n    return currentLoad;\n  }\n  function commit(to) {\n    if (this.pendingTo === to) {\n      if (process.env.NODE_ENV === \"development\") {\n        if (this.staged === STAGED_NO_VALUE) {\n          console.warn(\n            `Loader \"${options.key}\"'s \"commit()\" was called but there is no staged data.`\n          );\n        }\n      }\n      if (this.staged !== STAGED_NO_VALUE) {\n        this.data.value = this.staged;\n      }\n      this.error.value = this.stagedError;\n      this.staged = STAGED_NO_VALUE;\n      this.stagedError = this.error.value;\n      this.pendingTo = null;\n      for (const childEntry of this.children) {\n        childEntry.commit(to);\n      }\n    }\n  }\n  const useDataLoader = () => {\n    const [parentEntry, _router, _route] = getCurrentContext();\n    const router = _router || useRouter();\n    const route = _route || useRoute();\n    const entries = router[LOADER_ENTRIES_KEY];\n    let entry = entries.get(loader);\n    if (\n      // if the entry doesn't exist, create it with load and ensure it's loading\n      !entry || // the existing pending location isn't good, we need to load again\n      parentEntry && entry.pendingTo !== route\n    ) {\n      router[APP_KEY].runWithContext(() => load(route, router, parentEntry));\n    }\n    entry = entries.get(loader);\n    if (parentEntry) {\n      if (parentEntry === entry) {\n        console.warn(\n          `\\u{1F476}\\u274C \"${options.key}\" has itself as parent. This shouldn't be happening. Please report a bug with a reproduction to https://github.com/posva/unplugin-vue-router/`\n        );\n      }\n      parentEntry.children.add(entry);\n    }\n    const { data, error, isLoading } = entry;\n    const useDataLoaderResult = {\n      data,\n      error,\n      isLoading,\n      reload: (to = router.currentRoute.value) => router[APP_KEY].runWithContext(() => load(to, router)).then(\n        () => entry.commit(to)\n      )\n    };\n    const promise = entry.pendingLoad.then(() => {\n      return entry.staged === STAGED_NO_VALUE ? data.value : entry.staged;\n    }).catch((e) => parentEntry ? Promise.reject(e) : null);\n    return Object.assign(promise, useDataLoaderResult);\n  };\n  useDataLoader[IS_USE_DATA_LOADER_KEY] = true;\n  useDataLoader._ = {\n    load,\n    options,\n    // @ts-expect-error: return type has the generics\n    getEntry(router) {\n      return router[LOADER_ENTRIES_KEY].get(loader);\n    }\n  };\n  return useDataLoader;\n}\nvar DEFAULT_DEFINE_LOADER_OPTIONS = {\n  lazy: false,\n  server: true,\n  commit: \"after-load\"\n};\nvar SERVER_INITIAL_DATA_KEY = Symbol();\nvar INITIAL_DATA_KEY = Symbol();\nexport {\n  defineBasicLoader\n};\n"],
  "mappings": "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",
  "names": []
}
